!function(e){"use strict";function t(e){var t;if(t)return t.open(),!1;(t=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",multiple:!1})).on("insert",function(){var a=t.state().get("selection").first().toJSON();if(0==a.url.trim().length)return!1;e(a)}),t.state("embed").on("select",function(){var a=t.state().props.toJSON();if(0==a.url.trim().length)return!1;a.id=0,e(a)}),t.on("open",function(){jQuery("#menu-item-gallery, #menu-item-playlist, #menu-item-video-playlist").hide()}),t.open()}function a(t){t.autocomplete({source:function(t,a){e.ajax({url:ajaxurl,dataType:"json",method:"post",data:{action:"aiovg_autocomplete_get_videos",security:aiovg_admin.ajax_nonce,term:t.term},success:function(t){a(e.map(t,function(e){return{label:e.post_title,value:e.post_title,data:e}}))}})},autoFocus:!0,minLength:0,select:function(t,a){var i=e(this).closest(".aiovg-widget-field"),o="";0!=a.item.data.ID?(o='<span class="dashicons dashicons-yes-alt"></span> ',o+="<span>"+a.item.data.post_title+"</span> ",o+='<a href="javascript:void(0);" class="aiovg-remove-autocomplete-result">'+aiovg_admin.i18n.remove+"</a>"):(o='<span class="dashicons dashicons-info"></span> ',o+="<span>"+aiovg_admin.i18n.no_video_selected+"</span>"),i.find(".aiovg-widget-input-id").val(a.item.data.ID).trigger("change"),i.find(".aiovg-autocomplete-result").html(o)},open:function(){e(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){e(this).removeClass("ui-corner-top").addClass("ui-corner-all"),e(this).val("")}})}function i(e){var t=document.createElement("input");t.value=e,document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),t.remove(),alert(aiovg_admin.i18n.copied+"\n"+e)}e.fn.aiovgReplaceClass=function(e,t){return this.removeClass(function(t,a){var i=a.match(e);return i?i.join(" "):""}).addClass(t),this},e(function(){var o,s;e(document).on("click",".aiovg-upload-media",function(a){a.preventDefault();var i=e(this);t(function(e){i.closest(".aiovg-media-uploader").find("input[type=text]").val(e.url).trigger("file.uploaded")})}),e.fn.wpColorPicker&&(e(".aiovg-color-picker").wpColorPicker(),e(document).on("widget-added widget-updated",function(t,a){a.find(".aiovg-color-picker").wpColorPicker({change:_.throttle(function(){e(this).trigger("change")},3e3)})})),e.fn.magnificPopup&&e(".aiovg-modal-button").magnificPopup({type:"inline",mainClass:"mfp-fade"}),e("#aiovg-shortcode-selector input[type=radio]").on("change",function(){var t=e("#aiovg-shortcode-selector input[type=radio]:checked").val();e(".aiovg-shortcode-form").hide(),e("#aiovg-shortcode-form-"+t).show(),e(".aiovg-shortcode-instructions").hide(),e("#aiovg-shortcode-instructions-"+t).show()}).trigger("change"),e("#aiovg-shortcode-forms .aiovg-shortcode-section-header").on("click",function(){var t=e(this),a=t.parent();a.hasClass("aiovg-active")||t.closest(".aiovg-shortcode-form").find(".aiovg-active").removeClass("aiovg-active").find(".aiovg-shortcode-controls").slideToggle(),a.toggleClass("aiovg-active").find(".aiovg-shortcode-controls").slideToggle()}),e("#aiovg-shortcode-form-video select[name=type]").on("change",function(){var t=e(this).val();e("#aiovg-shortcode-form-video").aiovgReplaceClass(/\aiovg-type-\S+/ig,"aiovg-type-"+t)}),e("#aiovg-shortcode-form-videos select[name=template]").on("change",function(){var t=e(this).val();e("#aiovg-shortcode-form-videos").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+t)}).trigger("change"),e("#aiovg-shortcode-form-categories select[name=template]").on("change",function(){var t=e(this).val();e("#aiovg-shortcode-form-categories").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+t)}).trigger("change"),e("#aiovg-generate-shortcode").on("click",function(t){t.preventDefault();var a=e("#aiovg-shortcode-selector input[type=radio]:checked").val(),i=a,o={};for(var s in e(".aiovg-shortcode-field","#aiovg-shortcode-form-"+a).each(function(){var t=e(this),a=t.attr("type"),i=t.attr("name"),s=t.val(),n=0;void 0!==t.data("default")&&(n=t.data("default")),"checkbox"==a?s=t.is(":checked")?1:0:("category"==i||"tag"==i)&&(s=t.find("input[type=checkbox]:checked").map(function(){return this.value}).get().join(",")),s!=n&&(o[i]=s)}),o)o.hasOwnProperty(s)&&(i+=" "+s+'="'+o[s]+'"');e("#aiovg-shortcode").val("[aiovg_"+i+"]")}),e("#aiovg-issues-check-all").on("change",function(){var t=!!e(this).is(":checked");e("#aiovg-issues .aiovg-issue").prop("checked",t)}),e("#aiovg-issues-form").submit(function(){if(!(e("#aiovg-issues .aiovg-issue:checked").length>0))return alert(aiovg_admin.i18n.no_issues_selected),!1}),e(".aiovg-copy-url").on("click",function(){i(e(this).data("url"))}),e(".aiovg-copy-shortcode").on("click",function(){var t;i('[aiovg_video id="'+parseInt(e(this).data("id"))+'"]')}),e("#aiovg-video-type").on("change",function(t){t.preventDefault();var a=e(this).val();e(".aiovg-toggle-fields").hide(),e(".aiovg-type-"+a).show(300)}).trigger("change"),e("#aiovg-add-new-source").on("click",function(t){t.preventDefault();var a=e(this),i=parseInt(e(this).data("limit")),o=e("#aiovg-field-mp4 .aiovg-quality-selector").length,s=o-1;0==s&&e("#aiovg-field-mp4 .aiovg-quality-selector").show();var n=document.querySelector("#aiovg-template-source");if(null!==n){var r=n.content.cloneNode(!0);r.querySelector("input[type=radio]").setAttribute("name","quality_levels["+s+"]"),r.querySelector("input[type=text]").setAttribute("name","sources["+s+"]"),a.before(r)}o+1>=i&&a.hide()}),e("#aiovg-field-mp4").on("change",".aiovg-quality-selector input[type=radio]",function(){var t=e(this),a=[];e(".aiovg-quality-selector").each(function(){var i=e(this).find("input[type=radio]:checked").val();i&&(a.includes(i)?(t.prop("checked",!1),alert(aiovg_admin.i18n.quality_exists)):a.push(i))})}),e("#aiovg-add-new-track").on("click",function(t){t.preventDefault();var a=document.querySelector("#aiovg-template-track");if(null!==a){var i=a.content.cloneNode(!0);e("#aiovg-tracks").append(i)}}),0==e("#aiovg-tracks .aiovg-tracks-row").length&&e("#aiovg-add-new-track").trigger("click"),e(document).on("click",".aiovg-upload-track",function(a){a.preventDefault();var i=e(this);t(function(e){i.closest("tr").find(".aiovg-track-src input[type=text]").val(e.url)})}),e(document).on("click",".aiovg-delete-track",function(t){t.preventDefault(),e(this).closest("tr").remove()}),e.fn.sortable&&((o=e("#aiovg-tracks tbody")).hasClass("ui-sortable")&&o.sortable("destroy"),o.sortable({handle:".aiovg-handle"})),e("#aiovg-add-new-chapter").on("click",function(t){t.preventDefault();var a=document.querySelector("#aiovg-template-chapter");if(null!==a){var i=a.content.cloneNode(!0);e("#aiovg-chapters").append(i)}}),0==e("#aiovg-chapters .aiovg-chapters-row").length&&e("#aiovg-add-new-chapter").trigger("click"),e(document).on("click",".aiovg-delete-chapter",function(t){t.preventDefault(),e(this).closest("tr").remove()}),e.fn.sortable&&((s=e("#aiovg-chapters tbody")).hasClass("ui-sortable")&&s.sortable("destroy"),s.sortable({handle:".aiovg-handle"})),e("#aiovg-field-access_control select").on("change",function(){2==parseInt(e(this).val())?e("#aiovg-field-restricted_roles").show():e("#aiovg-field-restricted_roles").hide()}),e("#aiovg-categories-upload-image").on("click",function(a){a.preventDefault(),t(function(t){e("#aiovg-categories-image-wrapper").html('<img src="'+t.url+'" alt="" />'),e("#aiovg-categories-image").val(t.url),e("#aiovg-categories-image_id").val(t.id),e("#aiovg-categories-upload-image").hide(),e("#aiovg-categories-remove-image").show()})}),e("#aiovg-categories-remove-image").on("click",function(t){t.preventDefault(),e("#aiovg-categories-image-wrapper").html(""),e("#aiovg-categories-image").val(""),e("#aiovg-categories-image_id").val(""),e("#aiovg-categories-remove-image").hide(),e("#aiovg-categories-upload-image").show()}),e(document).ajaxComplete(function(t,a,i){if(e("#aiovg-categories-image").length&&i.data){var o=i.data.split("&");-1!==e.inArray("action=add-tag",o)&&e(a.responseXML).find("term_id").text()&&(e("#aiovg-categories-image-wrapper").html(""),e("#aiovg-categories-image").val(""),e("#aiovg-categories-image_id").val(""),e("#aiovg-categories-remove-image").hide(),e("#aiovg-categories-upload-image").show(),e("#aiovg-categories-exclude_search_form").prop("checked",!1),e("#aiovg-categories-exclude_video_form").prop("checked",!1))}}),e("#aiovg-settings .form-table").each(function(){var t=e(this).find("tr:first th label").attr("for").split("[");t=t[0].replace(/_/g,"-"),e(this).attr("id",t)}),e("#aiovg-player-settings tr.player input[type=radio]").on("change",function(){var t=e("#aiovg-player-settings tr.player input[type=radio]:checked").val();e("#aiovg-player-settings").aiovgReplaceClass(/\aiovg-player-\S+/ig,"aiovg-player-"+t)}).trigger("change"),e("#aiovg-categories-settings tr.template select").on("change",function(){var t=e(this).val();e("#aiovg-categories-settings").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+t)}).trigger("change"),e("#aiovg-videos-settings tr.template select").on("change",function(){var t=e(this).val();e("#aiovg-videos-settings").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+t)}).trigger("change"),e("#aiovg-restrictions-settings tr.access_control select").on("change",function(){2==parseInt(e(this).val())?e("#aiovg-restrictions-settings tr.restricted_roles").show():e("#aiovg-restrictions-settings tr.restricted_roles").hide()}).trigger("change"),e(document).on("change",".aiovg-widget-form-categories .aiovg-widget-input-template",function(){var t=e(this).val();e(this).closest(".aiovg-widget-form-categories").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+t)}),e(document).on("change",".aiovg-widget-form-videos .aiovg-widget-input-template",function(){var t=e(this).val();e(this).closest(".aiovg-widget-form-videos").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+t)}),e.fn.autocomplete&&(e(".aiovg-autocomplete-input").each(function(){a(e(this))}),e(document).on("widget-added widget-updated",function(e,t){var i=t.find(".aiovg-autocomplete-input");i.length>0&&a(i)}),e(document).on("click",".aiovg-remove-autocomplete-result",function(){var t=e(this).closest(".aiovg-widget-field"),a='<span class="dashicons dashicons-info"></span> ';a+="<span>"+aiovg_admin.i18n.no_video_selected+"</span>",t.find(".aiovg-widget-input-id").val(0).trigger("change"),t.find(".aiovg-autocomplete-result").html(a)}))})}(jQuery);